<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Qu·∫£n l√Ω Kh√°ch h√†ng - TravelAdmin</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <link href="assets/img/favicon.png" rel="icon">
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
    <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
    <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">

    <link href="assets/css/style.css" rel="stylesheet">
</head>

<body>

    <header id="header" class="header fixed-top d-flex align-items-center">

        <div class="d-flex align-items-center justify-content-between">
            <a href="index.html" class="logo d-flex align-items-center">
                <img src="assets/img/logo.png" alt="">
                <span class="d-none d-lg-block">TravelAdmin</span>
            </a>
            <i class="bi bi-list toggle-sidebar-btn"></i>
        </div>
        <div class="search-bar">
            <form class="search-form d-flex align-items-center" method="POST" action="#">
                <input type="text" name="query" placeholder="Nh·∫≠p ƒëi·ªÅu ki·ªán t√¨m ki·∫øm" title="Enter search keyword">
                <button type="submit" title="Search"><i class="bi bi-search"></i></button>
            </form>
        </div>
        <nav class="header-nav ms-auto">
            <ul class="d-flex align-items-center">

                <li class="nav-item d-block d-lg-none">
                    <a class="nav-link nav-icon search-bar-toggle " href="#">
                        <i class="bi bi-search"></i>
                    </a>
                </li>
                <li class="nav-item dropdown">

                    <a class="nav-link nav-icon" href="#" data-bs-toggle="dropdown">
                        <i class="bi bi-bell"></i>
                        <span class="badge bg-primary badge-number">3</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow notifications">
                        <li class="dropdown-header">
                            B·∫°n c√≥ 3 th√¥ng b√°o m·ªõi
                            <a href="#"><span class="badge rounded-pill bg-primary p-2 ms-2">Xem t·∫•t c·∫£</span></a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li class="notification-item">
                            <i class="bi bi-exclamation-circle text-warning"></i>
                            <div>
                                <h4>Tour ƒê√† L·∫°t s·∫Øp kh·ªüi h√†nh</h4>
                                <p>Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin v√© v√† l·ªãch tr√¨nh tr∆∞·ªõc khi ƒëi.</p>
                                <p>30 ph√∫t tr∆∞·ªõc</p>
                            </div>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li class="notification-item">
                            <i class="bi bi-x-circle text-danger"></i>
                            <div>
                                <h4>Thanh to√°n th·∫•t b·∫°i</h4>
                                <p>Giao d·ªãch ƒë·∫∑t tour Nha Trang ch∆∞a ƒë∆∞·ª£c ho√†n t·∫•t. Vui l√≤ng th·ª≠ l·∫°i.</p>
                                <p>1 gi·ªù tr∆∞·ªõc</p>
                            </div>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li class="notification-item">
                            <i class="bi bi-info-circle text-primary"></i>
                            <div>
                                <h4>∆Øu ƒë√£i m·ªõi d√†nh cho b·∫°n</h4>
                                <p>Gi·∫£m ngay 15% cho tour ƒê√† N·∫µng n·∫øu ƒë·∫∑t trong h√¥m nay!</p>
                                <p>4 gi·ªù tr∆∞·ªõc</p>
                            </div>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li class="dropdown-footer">
                            <a href="#">Xem t·∫•t c·∫£</a>
                        </li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link nav-icon" href="#" data-bs-toggle="dropdown">
                        <i class="bi bi-chat-left-text"></i>
                        <span class="badge bg-success badge-number">3</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow messages">
                        <li class="dropdown-header">
                            B·∫°n c√≥ 3 tin nh·∫Øn m·ªõi
                            <a href="#"><span class="badge rounded-pill bg-primary p-2 ms-2">Xem t·∫•t c·∫£</span></a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li class="message-item">
                            <a href="#">
                                <img src="assets/img/messages-1.jpg" alt="" class="rounded-circle">
                                <div>
                                    <h4>Mai Tran</h4>
                                    <p>Chuy·∫øn ƒëi th·∫≠t tuy·ªát v·ªùi! D·ªãch v·ª• chu ƒë√°o, h∆∞·ªõng d·∫´n vi√™n th√¢n thi·ªán v√† l·ªãch
                                        tr√¨nh
                                        r·∫•t h·ª£p l√Ω.</p>
                                    <p>4 gi·ªù tr∆∞·ªõc</p>
                                </div>
                            </a>
                        </li>
                        <li>
                        <li class="message-item">
                            <a href="#">
                                <img src="assets/img/messages-2.jpg" alt="" class="rounded-circle">
                                <div>
                                    <h4>John Doe</h4>
                                    <p>T√¥i r·∫•t h√†i l√≤ng v·ªõi chuy·∫øn du l·ªãch v·ª´a r·ªìi. M·ªçi th·ª© ƒë·ªÅu ƒë∆∞·ª£c t·ªï ch·ª©c chuy√™n
                                        nghi·ªáp
                                        v√†
                                        t√¥i ƒë√£ c√≥ nh·ªØng tr·∫£i nghi·ªám tuy·ªát v·ªùi.</p>
                                    <p>6 gi·ªù tr∆∞·ªõc</p>
                                </div>
                        </li>
                </li>

                <li class="dropdown-footer">
                    <a href="#">T·∫•t c·∫£ tin nh·∫Øn</a>
                </li>

            </ul>
            </li>
            <li class="nav-item dropdown pe-3">

                <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
                    <img src="assets/img/profile-img.jpg" alt="Profile" class="rounded-circle">
                    <span class="d-none d-md-block dropdown-toggle ps-2">ThaoHT</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                    <li class="dropdown-header">
                        <h6>Thao Thu Hoang</h6>
                        <span>Nh√† ph√°t tri·ªÉn web</span>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>

                    <li>
                        <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                            <i class="bi bi-person"></i>
                            <span>Th√¥ng tin c√° nh√¢n</span>
                        </a>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>

                    <li>
                        <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                            <i class="bi bi-gear"></i>
                            <span>Ch·ªânh s·ª≠a t√†i kho·∫£n</span>
                        </a>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>

                    <li>
                        <a class="dropdown-item d-flex align-items-center" href="faq.html">
                            <i class="bi bi-question-circle"></i>
                            <span>B·∫°n c·∫ßn gi√∫p ƒë·ª°?</span>
                        </a>
                    </li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>

                    <li>
                        <a class="dropdown-item d-flex align-items-center" href="#">
                            <i class="bi bi-box-arrow-right"></i>
                            <span>ƒêƒÉng xu·∫•t</span>
                        </a>
                    </li>

                </ul>
            </li>
            </ul>
        </nav>
    </header>
    <aside id="sidebar" class="sidebar">

        <ul class="sidebar-nav" id="sidebar-nav">

            <li class="nav-item">
                <a class="nav-link collapsed" href="index.html">
                    <i class="bi bi-grid"></i>
                    <span>Trang ch·ªß</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#components-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-globe-asia-australia"></i><span>Qu·∫£n l√Ω chuy·∫øn ƒëi</span><i
                        class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="components-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                    <li>
                        <a href="tour-managerment.html">
                            <i class="bi bi-circle"></i><span>Qu·∫£n l√Ω th√¥ng tin chuy·∫øn ƒëi</span>
                        </a>
                    </li>
                    <li>
                        <a href="tour-category.html">
                            <i class="bi bi-circle"></i><span>Qu·∫£n l√Ω danh m·ª•c chuy·∫øn ƒëi</span>
                        </a>
                    </li>
                </ul>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="order.html">
                    <i class="bi bi-cash-coin"></i><span> Qu·∫£n l√Ω ƒë∆°n h√†ng</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link " href="users.html">
                    <i class="bi bi-people"></i><span>Qu·∫£n l√Ω kh√°ch h√†ng</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="charts.html">
                    <i class="bi bi-bar-chart"></i><span>Th·ªëng k√™</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="employees.html">
                    <i class="bi bi-person-check-fill"></i><span>Qu·∫£n l√Ω nh√¢n vi√™n</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="promotion.html">
                    <i class="bi bi-gift"></i><span>Qu·∫£n l√Ω khuy·∫øn m√£i</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="content.html">
                    <i class="bi bi-file-earmark-richtext"></i><span>Qu·∫£n l√Ω n·ªôi dung</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="settings.html">
                    <i class="bi bi-gear"></i><span>C√†i ƒë·∫∑t</span>
                </a>
            </li>
            <li class="nav-heading">Pages</li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="faq.html">
                    <i class="bi bi-question-circle"></i>
                    <span>F.A.Q</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="#">
                    <i class="bi bi-box-arrow-in-right"></i>
                    <span>ƒêƒÉng xu·∫•t</span>
                </a>
            </li>
        </ul>
    </aside>

    <main id="main" class="main">
        <div class="pagetitle">
            <h1>Qu·∫£n l√Ω th√¥ng tin kh√°ch h√†ng</h1>
            <nav>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">Trang ch·ªß</a></li>
                    <li class="breadcrumb-item active"><a href="users.html">Qu·∫£n l√Ω th√¥ng tin kh√°ch h√†ng</a></li>
                </ol>
            </nav>
        </div>
        <section class="section dashboard">
            <div class="row">
                <div class="col-xxl-4 col-md-6">
                    <div class="card info-card tour-card">
                        <div class="card-body">
                            <h5 class="card-title"> T·ªïng s·ªë kh√°ch h√†ng</h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    <i class="bi bi-people-fill"></i>
                                </div>
                                <div class="ps-3">
                                    <h6>1232</h6>
                                    <i class="bi bi-graph-up-arrow"></i>
                                    <span class="text-success small pt-1 fw-bold">8%</span> <span
                                        class="text-muted small pt-2 ps-1">TƒÉng</span>

                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="col-xxl-4 col-md-6">
                    <div class="card info-card revenue-tour">
                        <div class="card-body">
                            <h5 class="card-title">T·ªïng s·ªë kh√°ch h√†ng th√¢n thi·∫øt</h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    <i class="bi bi-person-hearts"></i>
                                </div>
                                <div class="ps-3">
                                    <h6>12220000000</h6>
                                    <i class="bi bi-graph-up-arrow"></i>
                                    <span class="text-success small pt-1 fw-bold">8%</span> <span
                                        class="text-muted small pt-2 ps-1">TƒÉng</span>

                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-2">
                                    <h5 class="card-title mb-0">Danh s√°ch ng∆∞·ªùi d√πng</h5>

                                </div>
                                <div id="bulkActionBar"
                                    class="d-none bg-light border rounded p-2 mb-3 d-flex align-items-center justify-content-between">
                                    <button class="btn btn-danger btn-sm" id="deleteSelectedBtn">
                                        <i class="bi bi-trash"></i> X√≥a ng∆∞·ªùi d√πng ƒë√£ ch·ªçn
                                    </button>
                                </div>
                                <table class="table datatable">
                                    <thead>
                                        <tr>
                                            <th style="width: 40px;">
                                                <input type="checkbox" id="selectAll">
                                            </th>
                                            <th>M√£ kh√°ch h√†ng</th>
                                            <th>T√™n kh√°ch h√†ng</th>
                                            <th>Li√™n h·ªá</th>
                                            <th>M·ª©c vip</th>
                                            <th>Tr·∫°ng th√°i</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>

                                            <td>KH001</td>
                                            <td>Nguy·ªÖn VƒÉn A</td>
                                            <td>
                                                example@gmail.com<br>
                                                0987654321
                                            </td>
                                            <td>
                                                <span class="vip-badge vip-gold">V√†ng</span>
                                            </td>
                                            <td><span class="badge bg-success">Ho·∫°t ƒë·ªông</span></td>

                                        </tr>
                                        <tr>
                                            <td>KH002</td>
                                            <td>Tr·∫ßn Th·ªã B</td>
                                            <td>
                                                example@gmail.com<br>
                                                0987654321
                                            </td>
                                            <td>
                                                <span class="vip-badge vip-silver">B·∫°c</span>
                                            </td>
                                            <td><span class="badge bg-success">Ho·∫°t ƒë·ªông</span></td>

                                        </tr>
                                        <tr>
                                            <td>KH003</td>
                                            <td>Ph·∫°m VƒÉn C</td>
                                            <td>
                                                example@gmail.com<br>
                                                0987654321
                                            </td>
                                            <td>
                                                <span class="vip-badge vip-bronze">ƒê·ªìng</span>
                                            </td>
                                            <td><span class="badge bg-danger">Kh√≥a</span></td>

                                        </tr>
                                        <tr>
                                            <td>KH004</td>
                                            <td>ƒê·ªó Th·ªã D</td>
                                            <td>
                                                example@gmail.com<br>
                                                0987654321
                                            </td>
                                            <td>
                                                <span class="vip-badge vip-bronze">ƒê·ªìng</span>
                                            </td>
                                            <td><span class="badge bg-success">Ho·∫°t ƒë·ªông</span></td>

                                        </tr>
                                        <tr>
                                            <td>KH005</td>
                                            <td>V≈© VƒÉn E</td>
                                            <td>
                                                example@gmail.com<br>
                                                0987654321
                                            </td>
                                            <td>
                                                <span class="vip-badge vip-diamond">Kim c∆∞∆°ng</span>
                                            </td>
                                            <td><span class="badge bg-success">Ho·∫°t ƒë·ªông</span></td>

                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>
        </section>
    </main>
    <div class="modal fade" id="userDetailModal" tabindex="-1" aria-labelledby="userDetailModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <form id="editUserForm">
                    <div class="modal-header">
                        <h5 class="modal-title" id="userDetailModalLabel">Th√¥ng tin chi ti·∫øt kh√°ch h√†ng</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3" id="userIdGroup">
                            <label for="userIdInput" class="form-label">M√£ kh√°ch h√†ng</label>
                            <input type="text" class="form-control" id="userIdInput" name="userId" disabled>
                        </div>
                        <div class="mb-3">
                            <label for="userNameInput" class="form-label">T√™n kh√°ch h√†ng</label>
                            <input type="text" class="form-control" id="userNameInput" name="userName" disabled>
                        </div>
                        <div class="mb-3">
                            <label for="userEmailInput" class="form-label">Email</label>
                            <input type="email" class="form-control" id="userEmailInput" name="userEmail" disabled>
                        </div>
                        <div class="mb-3">
                            <label for="userPhoneInput" class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
                            <input type="text" class="form-control" id="userPhoneInput" name="userPhone" disabled>
                        </div>
                        <div class="mb-3">
                            <label for="userVipInput" class="form-label">M·ª©c vip</label>
                            <input type="text" id="userVipInput" name="userVip" class="form-control" disabled>
                        </div>

                        <div class="mb-3">
                            <label for="userStatusInput" class="form-label">Tr·∫°ng th√°i</label>
                            <select id="userStatusInput" name="userStatus" class="form-select">
                                <option value="Ho·∫°t ƒë·ªông">Ho·∫°t ƒë·ªông</option>
                                <option value="Kh√≥a">Kh√≥a</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="reset_password">ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u</button>
                        <button type="button" class="btn btn-danger" id="deleteUserBtn">X√≥a kh√°ch h√†ng</button>
                        <button type="submit" class="btn btn-primary">L∆∞u</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <footer id="footer" class="footer">
        <div class="copyright">
            &copy; Copyright <strong><span>Nh√≥m 5</span></strong>. M·ªçi quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u
        </div>
        <div class="credits">
            Thi·∫øt k·∫ø b·ªüi <a href="https://bootstrapmade.com/">BootstrapMade</a>
        </div>
    </footer>
    <div id="alert-container"></div>

    <script src="./assets/js/tour_category.js"></script>

    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js" defer></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js" defer></script>
    <!-- <script src="assets/vendor/simple-datatables/simple-datatables.js" defer></script> -->
    <script src="assets/js/main.js" defer></script>
    <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <style>
        /* Alert g√≥c ph·∫£i */
        #alert-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1080;
            width: 320px;
        }

        .alert {
            animation: fadeIn 0.4s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: 8px;
        }

        .datatable tbody tr:hover {
            background-color: #f0f5ff !important;
            /* M√†u xanh nh·∫°t khi hover */
            cursor: pointer;
        }

        .vip-badge {
            padding: 0.3em 0.6em;
            border-radius: 0.25rem;
            color: #fff;
            font-weight: 600;
            font-size: 0.75em;
        }

        .vip-normal {
            background-color: #6c757d;
        }

        .vip-bronze {
            background-color: #cd7f32;
        }

        .vip-silver {
            background-color: #c0c0c0;
            color: #333;
        }

        .vip-gold {
            background-color: #ffd700;
            color: #333;
        }

        .vip-diamond {
            background: linear-gradient(45deg, #e6e6e6, #b8b8b8);
            color: #333;
            border: 1px solid #aaa;
        }
    </style>

    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const API_URL = "http://localhost:8080/api/v1/users";

            let currentUser = null;
            let currentId = null;
            let selectedIds = new Set();

            const modalEl = document.getElementById("userDetailModal");
            const modal = new bootstrap.Modal(modalEl);
            const form = document.getElementById("editUserForm");
            const deleteBtn = document.getElementById("deleteUserBtn");
            const resetPassBtn = document.getElementById("reset_password");
            const modalTitle = document.getElementById("userDetailModalLabel");
            const selectAll = document.getElementById("selectAll");

            const bulkActionBar = document.getElementById("bulkActionBar");
            const deleteSelectedBtn = document.getElementById("deleteSelectedBtn");

            // ==========================================
            // ALERT G√ìC PH·∫¢I
            // ==========================================
            function showAlert(message, type = 'success') {
                const container = document.getElementById('alert-container');
                const icons = { success: 'bi-check-circle-fill', info: 'bi-info-circle-fill', warning: 'bi-exclamation-triangle-fill', danger: 'bi-x-circle-fill' };
                const alert = document.createElement('div');
                alert.className = `alert alert-${type} bg-${type} text-light alert-dismissible fade show mb-2`;
                alert.innerHTML = `<i class="bi ${icons[type]} me-2"></i>${message}
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert"></button>`;
                container.appendChild(alert);
                setTimeout(() => alert.remove(), 3000);
            }

            // C·∫≠p nh·∫≠t thanh h√†nh ƒë·ªông h√†ng lo·∫°t
            function toggleBulkBar() {
                // countEl.textContent = selectedIds.size; // ƒê√£ th√™m span#selectedCount v√†o HTML
                bulkActionBar.classList.toggle('d-none', selectedIds.size === 0);
            }


            function highlightRow(cb, checked) {
                const tr = cb.closest('tr');
                if (checked) tr.classList.add('table-active');
                else tr.classList.remove('table-active');
            }

            // ==========================================
            // LOAD USERS DATATABLE
            // ==========================================
            function loadUsers() {

                if ($.fn.DataTable.isDataTable(".datatable")) {
                    $(".datatable").DataTable().ajax.reload(attachCheckboxEvents, false);
                    return;
                }

                $(".datatable").DataTable({
                    serverSide: true,
                    processing: true,
                    searching: true,
                    autoWidth: false,
                    scrollX: true,
                    lengthChange: true,
                    pageLength: 5,
                    lengthMenu: [[5, 10, 25, 50], [5, 10, 25, 50]],
                    order: [[1, 'desc']],
                    columnDefs: [
                        { targets: 0, orderable: false, searchable: false }],
                    ajax: function (data, callback) {
                        const page = Math.floor(data.start / data.length);
                        const size = data.length;
                        const search = data.search.value;
                        const sortIndex = data.order[0].column;
                        const sortDir = data.order[0].dir;

                        const columnMap = ["id", "userId", "fullname", "email", "userRank", "status"];
                        const sortColumn = columnMap[sortIndex] || "userId";

                        const url = `${API_URL}?page=${page}&size=${size}&sort=${sortColumn},${sortDir}&keyword=${search}`;

                        fetch(url)
                            .then(r => r.json())
                            .then(json => {
                                callback({
                                    recordsTotal: json.totalElements,
                                    recordsFiltered: json.totalElements,
                                    data: json.content
                                });
                            });
                    },
                    columnDefs: [
                        { targets: 0, orderable: false }
                    ],
                    columns: [
                        {
                            data: null,
                            render: row => `<input type="checkbox" class="user-row-checkbox" data-id="${row.userId}">`
                        },
                        { data: "userId" },
                        { data: "fullname" },
                        {
                            data: row => `${row.email}<br>${row.phoneNumber}`
                        },
                        {
                            data: "userRank",
                            render: r => `<span class="vip-badge vip-${r.toLowerCase()}">${r}</span>`
                        },
                        {
                            data: "status",
                            render: s => s === "ACTIVE"
                                ? `<span class="badge bg-success">Ho·∫°t ƒë·ªông</span>`
                                : `<span class="badge bg-danger">Kh√≥a</span>`
                        }
                    ],
                    language: {
                        searchPlaceholder: "üîé T√¨m ki·∫øm...",
                        search: "",
                        lengthMenu: "_MENU_ / d√≤ng",
                        info: "Hi·ªÉn th·ªã _START_‚Äì_END_ trong t·ªïng _TOTAL_ danh m·ª•c",
                        infoEmpty: "Kh√¥ng c√≥ d·ªØ li·ªáu",
                        infoFiltered: "(l·ªçc t·ª´ _MAX_ b·∫£n ghi)",
                        zeroRecords: "Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p",
                        loadingRecords: "ƒêang t·∫£i d·ªØ li·ªáu...",
                        emptyTable: "Kh√¥ng c√≥ d·ªØ li·ªáu",
                        paginate: {
                            previous: "‚Üê",
                            next: "‚Üí"
                        }
                    }
                });

                $(".datatable").on("draw.dt", attachCheckboxEvents);
            }

            // ==========================================
            // CHECKBOX CH·ªåN NHI·ªÄU
            // ==========================================
            function attachCheckboxEvents() {
                if (selectAll) selectAll.checked = false;
                const rowCheckboxes = document.querySelectorAll(".user-row-checkbox");
                // --- A. Ch·ªçn t·∫•t c·∫£ ---
                if (selectAll) {
                    selectAll.onchange = e => {
                        const checked = e.target.checked;
                        selectedIds.clear(); // X√≥a t·∫•t c·∫£ tr∆∞·ªõc khi th√™m m·ªõi
                        rowCheckboxes.forEach(cb => {
                            cb.checked = checked;
                            const id = cb.dataset.id;
                            if (checked) selectedIds.add(id);
                            highlightRow(cb, checked);
                        });
                        toggleBulkBar();
                    };
                }

                // --- B. Ch·ªçn t·ª´ng d√≤ng ---
                rowCheckboxes.forEach(cb => {
                    const id = cb.dataset.id;
                    cb.checked = selectedIds.has(id);
                    highlightRow(cb, selectedIds.has(id));
                    cb.onchange = e => {
                        const checked = e.target.checked;
                        if (checked) selectedIds.add(id);
                        else selectedIds.delete(id);

                        highlightRow(cb, checked);
                        toggleBulkBar();

                        // N·∫øu b·ªè ch·ªçn 1 d√≤ng => b·ªè check "Ch·ªçn t·∫•t c·∫£"
                        if (!checked && selectAll) {
                            selectAll.checked = false;
                        }
                        // N·∫øu t·∫•t c·∫£ d√≤ng ƒë∆∞·ª£c ch·ªçn => check "Ch·ªçn t·∫•t c·∫£"
                        else if (checked && selectAll) {
                            const allChecked = Array.from(rowCheckboxes).every(cb => cb.checked);
                            selectAll.checked = allChecked;
                        }
                    }
                });
            }


            // ==========================================
            // HI·ªÜN MODAL USER
            // ==========================================
            async function showModalForEdit(id) {
                const res = await fetch(`${API_URL}/${id}`);
                const user = await res.json();

                currentUser = user;
                currentId = id;

                modalTitle.textContent = `Th√¥ng tin kh√°ch h√†ng #${id}`;
                document.getElementById("userIdInput").value = user.userId;
                document.getElementById("userNameInput").value = user.fullname;
                document.getElementById("userEmailInput").value = user.email;
                document.getElementById("userPhoneInput").value = user.phoneNumber;
                document.getElementById("userVipInput").value = user.userRank;
                document.getElementById("userStatusInput").value =
                    user.status === "ACTIVE" ? "Ho·∫°t ƒë·ªông" : "Kh√≥a";

                modal.show();
            }

            $(".datatable tbody").on("click", "tr", function (e) {
                if ($(e.target).is("input[type=checkbox]")) return;

                const table = $(".datatable").DataTable();
                const row = table.row(this).data();
                if (row) showModalForEdit(row.userId);
            });

            // ==========================================
            // UPDATE USER (send full DTO)
            // ==========================================
            form.addEventListener("submit", async function (e) {
                e.preventDefault();

                const newStatus =
                    document.getElementById("userStatusInput").value === "Ho·∫°t ƒë·ªông"
                        ? "ACTIVE"
                        : "INACTIVE";

                const body = {
                    userId: currentUser.userId,
                    username: currentUser.username,
                    fullname: currentUser.fullname,
                    dateOfBirth: currentUser.dateOfBirth,
                    phoneNumber: currentUser.phoneNumber,
                    email: currentUser.email,
                    userRank: currentUser.userRank,
                    status: newStatus,
                    accountId: currentUser.accountId
                };

                const res = await fetch(`${API_URL}/${currentId}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(body)
                });

                modal.hide(); // üî• ƒë√≥ng modal
                if (res.ok) {
                    showAlert("C·∫≠p nh·∫≠t kh√°ch h√†ng th√†nh c√¥ng!", "success ");
                    loadUsers();
                } else {
                    showAlert("C·∫≠p nh·∫≠t th·∫•t b·∫°i!", "danger");
                }
            });

            // ==========================================
            // RESET PASSWORD
            // ==========================================
            resetPassBtn.addEventListener("click", async function () {
                const res = await fetch(`${API_URL}/${currentId}/reset-password`, { method: "PUT" });

                modal.hide(); // üî• ƒë√≥ng modal
                const text = await res.text();
                showAlert("ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u th√†nh c√¥ng", "success ");

            });

            // ==========================================
            // DELETE USER
            // ==========================================
            deleteBtn.addEventListener("click", async function () {
                if (!confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√°ch h√†ng n√†y?")) return;

                const res = await fetch(`${API_URL}/${currentId}`, { method: "DELETE" });

                modal.hide(); // üî• ƒë√≥ng modal
                if (res.ok) {
                    showAlert("X√≥a th√†nh c√¥ng!", "success");
                    loadUsers();
                }
            });

            // ==========================================
            // DELETE MULTIPLE USERS
            // ==========================================
            deleteSelectedBtn.addEventListener('click', async () => {
                if (selectedIds.size === 0) return;

                if (!confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ${selectedIds.size} ng∆∞·ªùi d√πng ƒë√£ ch·ªçn?`)) return;

                try {
                    const response = await fetch(`${API_URL}/bulk-delete`, {
                        method: 'DELETE',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify([...selectedIds])
                    });

                    const data = await response.json().catch(() => ({ message: "Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c ph·∫£n h·ªìi t·ª´ server!" }));

                    if (response.ok) {
                        showAlert(data.message || 'X√≥a th√†nh c√¥ng!', 'success');

                        // Reset danh s√°ch ch·ªçn
                        selectedIds.clear();
                        toggleBulkBar();

                        await loadUsers();

                    } else {
                        showAlert(data.message || 'X√≥a th·∫•t b·∫°i!', 'danger');
                    }

                } catch (err) {
                    console.error('L·ªói x√≥a ng∆∞·ªùi d√πng:', err);
                    showAlert('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß!', 'danger');
                }
            });

            // ==========================================
            // RUN
            // ==========================================
            loadUsers();

        });

    </script>
</body>

</html>