<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Qu·∫£n l√Ω danh m·ª•c tour - TravelAdmin</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <link href="assets/img/favicon.png" rel="icon">
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
    <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
    <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">

    <link href="assets/css/style.css" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">


    <style>
        .datatable tbody tr {
            cursor: pointer;
        }

        .datatable tbody tr:hover {
            background-color: #f6f9ff !important;
        }

        /* Alert g√≥c ph·∫£i */
        #alert-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1080;
            width: 320px;
        }

        .alert {
            animation: fadeIn 0.4s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: 8px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(50px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>

<body>

    <header id="header" class="header fixed-top d-flex align-items-center">

        <div class="d-flex align-items-center justify-content-between">
            <a href="index.html" class="logo d-flex align-items-center">
                <img src="assets/img/logo.png" alt="">
                <span class="d-none d-lg-block">TravelAdmin</span>
            </a>
            <i class="bi bi-list toggle-sidebar-btn"></i>
        </div>
        <div class="search-bar">
            <form class="search-form d-flex align-items-center" method="POST" action="#">
                <input type="text" name="query" placeholder="Nh·∫≠p ƒëi·ªÅu ki·ªán t√¨m ki·∫øm" title="Enter search keyword">
                <button type="submit" title="Search"><i class="bi bi-search"></i></button>
            </form>
        </div>
        <nav class="header-nav ms-auto">
            <ul class="d-flex align-items-center">

                <li class="nav-item d-block d-lg-none">
                    <a class="nav-link nav-icon search-bar-toggle " href="#">
                        <i class="bi bi-search"></i>
                    </a>
                </li>
                <li class="nav-item dropdown">

                    <a class="nav-link nav-icon" href="#" data-bs-toggle="dropdown">
                        <i class="bi bi-bell"></i>
                        <span class="badge bg-primary badge-number">3</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow notifications">
                        <li class="dropdown-header">
                            B·∫°n c√≥ 3 th√¥ng b√°o m·ªõi
                            <a href="#"><span class="badge rounded-pill bg-primary p-2 ms-2">Xem t·∫•t c·∫£</span></a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li class="notification-item">
                            <i class="bi bi-exclamation-circle text-warning"></i>
                            <div>
                                <h4>Tour ƒê√† L·∫°t s·∫Øp kh·ªüi h√†nh</h4>
                                <p>Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin v√© v√† l·ªãch tr√¨nh tr∆∞·ªõc khi ƒëi.</p>
                                <p>30 ph√∫t tr∆∞·ªõc</p>
                            </div>
                        </li>

                        <li>
                            <hr class="dropdown-divider">
                        </li>

                        <li class="notification-item">
                            <i class="bi bi-x-circle text-danger"></i>
                            <div>
                                <h4>Thanh to√°n th·∫•t b·∫°i</h4>
                                <p>Giao d·ªãch ƒë·∫∑t tour Nha Trang ch∆∞a ƒë∆∞·ª£c ho√†n t·∫•t. Vui l√≤ng th·ª≠ l·∫°i.</p>
                                <p>1 gi·ªù tr∆∞·ªõc</p>
                            </div>
                        </li>

                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li class="notification-item">
                            <i class="bi bi-info-circle text-primary"></i>
                            <div>
                                <h4>∆Øu ƒë√£i m·ªõi d√†nh cho b·∫°n</h4>
                                <p>Gi·∫£m ngay 15% cho tour ƒê√† N·∫µng n·∫øu ƒë·∫∑t trong h√¥m nay!</p>
                                <p>4 gi·ªù tr∆∞·ªõc</p>
                            </div>
                        </li>

                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li class="dropdown-footer">
                            <a href="#">Xem t·∫•t c·∫£</a>
                        </li>

                    </ul>
                </li>
                <li class="nav-item dropdown">

                    <a class="nav-link nav-icon" href="#" data-bs-toggle="dropdown">
                        <i class="bi bi-chat-left-text"></i>
                        <span class="badge bg-success badge-number">3</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow messages">
                        <li class="dropdown-header">
                            B·∫°n c√≥ 3 tin nh·∫Øn m·ªõi
                            <a href="#"><span class="badge rounded-pill bg-primary p-2 ms-2">Xem t·∫•t c·∫£</span></a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>

                        <li class="message-item">
                            <a href="#">
                                <img src="assets/img/messages-1.jpg" alt="" class="rounded-circle">
                                <div>
                                    <h4>Mai Tran</h4>
                                    <p>Chuy·∫øn ƒëi th·∫≠t tuy·ªát v·ªùi! D·ªãch v·ª• chu ƒë√°o, h∆∞·ªõng d·∫´n vi√™n th√¢n thi·ªán v√† l·ªãch
                                        tr√¨nh
                                        r·∫•t h·ª£p l√Ω.</p>
                                    <p>4 gi·ªù tr∆∞·ªõc</p>
                                </div>
                            </a>
                        </li>
                        <li class="message-item">
                            <a href="#">
                                <img src="assets/img/messages-2.jpg" alt="" class="rounded-circle">
                                <div>
                                    <h4>John Doe</h4>
                                    <p>T√¥i r·∫•t h√†i l√≤ng v·ªõi chuy·∫øn du l·ªãch v·ª´a r·ªìi. M·ªçi th·ª© ƒë·ªÅu ƒë∆∞·ª£c t·ªï ch·ª©c chuy√™n
                                        nghi·ªáp
                                        v√†
                                        t√¥i ƒë√£ c√≥ nh·ªØng tr·∫£i nghi·ªám tuy·ªát v·ªùi.</p>
                                    <p>6 gi·ªù tr∆∞·ªõc</p>
                                </div>
                        </li>

                        <li class="dropdown-footer">
                            <a href="#">T·∫•t c·∫£ tin nh·∫Øn</a>
                        </li>

                    </ul>
                </li>
                <li class="nav-item dropdown pe-3">

                    <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
                        <img src="assets/img/profile-img.jpg" alt="Profile" class="rounded-circle">
                        <span class="d-none d-md-block dropdown-toggle ps-2">ThaoHT</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                        <li class="dropdown-header">
                            <h6>Thao Thu Hoang</h6>
                            <span>Nh√† ph√°t tri·ªÉn web</span>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>

                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                                <i class="bi bi-person"></i>
                                <span>Th√¥ng tin c√° nh√¢n</span>
                            </a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>

                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                                <i class="bi bi-gear"></i>
                                <span>Ch·ªânh s·ª≠a t√†i kho·∫£n</span>
                            </a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>

                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="faq.html">
                                <i class="bi bi-question-circle"></i>
                                <span>B·∫°n c·∫ßn gi√∫p ƒë·ª°?</span>
                            </a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>

                        <li>
                            <a class="dropdown-item d-flex align-items-center" href="#">
                                <i class="bi bi-box-arrow-right"></i>
                                <span>ƒêƒÉng xu·∫•t</span>
                            </a>
                        </li>

                    </ul>
                </li>
            </ul>
        </nav>
    </header>
    <aside id="sidebar" class="sidebar">

        <ul class="sidebar-nav" id="sidebar-nav">

            <li class="nav-item">
                <a class="nav-link collapsed" href="index.html">
                    <i class="bi bi-grid"></i>
                    <span>Trang ch·ªß</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-target="#components-nav" data-bs-toggle="collapse" href="#">
                    <i class="bi bi-globe-asia-australia"></i><span>Qu·∫£n l√Ω chuy·∫øn ƒëi</span><i
                        class="bi bi-chevron-down ms-auto"></i>
                </a>
                <ul id="components-nav" class="nav-content collapse show" data-bs-parent="#sidebar-nav">
                    <li>
                        <a href="tour-managerment.html">
                            <i class="bi bi-circle"></i><span>Qu·∫£n l√Ω th√¥ng tin chuy·∫øn ƒëi</span>
                        </a>
                    </li>
                    <li>
                        <a href="tour-category.html" class="active">
                            <i class="bi bi-circle"></i><span>Qu·∫£n l√Ω danh m·ª•c chuy·∫øn ƒëi</span>
                        </a>
                    </li>
                </ul>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="order.html">
                    <i class="bi bi-cash-coin"></i><span> Qu·∫£n l√Ω ƒë∆°n h√†ng</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="users.html">
                    <i class="bi bi-people"></i><span>Qu·∫£n l√Ω kh√°ch h√†ng</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="charts.html">
                    <i class="bi bi-bar-chart"></i><span>Th·ªëng k√™</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="employees.html">
                    <i class="bi bi-person-check-fill"></i><span>Qu·∫£n l√Ω nh√¢n vi√™n</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="promotion.html">
                    <i class="bi bi-gift"></i><span>Qu·∫£n l√Ω khuy·∫øn m√£i</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="content.html">
                    <i class="bi bi-file-earmark-richtext"></i><span>Qu·∫£n l√Ω n·ªôi dung</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="settings.html">
                    <i class="bi bi-gear"></i><span>C√†i ƒë·∫∑t</span>
                </a>
            </li>
            <li class="nav-heading">Pages</li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="faq.html">
                    <i class="bi bi-question-circle"></i>
                    <span>F.A.Q</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link collapsed" href="#">
                    <i class="bi bi-box-arrow-in-right"></i>
                    <span>ƒêƒÉng xu·∫•t</span>
                </a>
            </li>
        </ul>
    </aside>

    <main id="main" class="main">
        <div class="pagetitle">
            <h1>Qu·∫£n l√Ω th√¥ng tin danh m·ª•c chuy·∫øn ƒëi</h1>
            <nav>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">Trang ch·ªß</a></li>
                    <li class="breadcrumb-item">Qu·∫£n l√Ω chuy·∫øn ƒëi</li>
                    <li class="breadcrumb-item active"><a href="tour-category.html">Qu·∫£n l√Ω danh m·ª•c chuy·∫øn ƒëi</a></li>
                </ol>
            </nav>
        </div>
        <section class="section dashboard">
            <div class="row">
                <div class="col-xxl-4 col-md-6">
                    <div class="card info-card tour-card">
                        <div class="card-body">
                            <h5 class="card-title"> T·ªïng s·ªë danh m·ª•c</h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    <i class="bi bi-folder-fill"></i>
                                </div>
                                <div class="ps-3">
                                    <h6 id="totalCategories">1232</h6>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="col-xxl-4 col-md-6">
                    <div class="card info-card tour-active-card">
                        <div class="card-body">
                            <h5 class="card-title">Trung b√¨nh chuy·∫øn ƒëi/ danh m·ª•c</h5>

                            <div class="d-flex align-items-center">
                                <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                                    <i class="bi bi-calculator"></i>
                                </div>
                                <div class="ps-3">
                                    <h6>1222</h6>
                                    <i class="bi bi-graph-up-arrow"></i>
                                    <span class="text-success small pt-1 fw-bold">8%</span> <span
                                        class="text-muted small pt-2 ps-1">TƒÉng</span>

                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-2">
                                    <h5 class="card-title mb-0">Danh s√°ch danh m·ª•c chuy·∫øn ƒëi</h5>
                                    <button type="button" class="btn btn-primary btn-sm shadow-sm"
                                        data-bs-toggle="modal" data-bs-target="#addTourModal"> <i
                                            class="bi bi-plus-circle me-1"></i> Th√™m danh m·ª•c m·ªõi
                                    </button>
                                </div>
                                <div id="bulkActionBar"
                                    class="d-none bg-light border rounded p-2 mb-3 d-flex align-items-center justify-content-between">
                                    <button class="btn btn-danger btn-sm" id="deleteSelectedBtn">
                                        <i class="bi bi-trash"></i> X√≥a danh m·ª•c ƒë√£ ch·ªçn
                                    </button>
                                </div>
                                <table id="categoryTable" class="table datatable">
                                    <thead>
                                        <tr>
                                            <th style="width: 40px;">
                                                <input type="checkbox" id="selectAll">
                                            </th>
                                            <th>M√£ danh m·ª•c</th>
                                            <th>T√™n danh m·ª•c</th>
                                            <th>M√¥ t·∫£</th>
                                            <th>S·ªë chuy·∫øn ƒëi</th>
                                            <th> Ng√†y t·∫°o</th>
                                            <th>Tr·∫°ng th√°i</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="6" class="text-center py-3 text-muted">ƒêang t·∫£i d·ªØ li·ªáu...</td>
                                        </tr>

                                        <tr>
                                            <td>T001</td>
                                            <td>Tour ƒëi bi·ªÉn</td>
                                            <td>C√°c tour du l·ªãch bi·ªÉn ƒë·∫£o, ngh·ªâ d∆∞·ª°ng t·∫°i c√°c b√£i bi·ªÉn ƒë·∫πp</td>
                                            <td>15</td>
                                            <td>2024/10/20</td>
                                            <td><span class="badge bg-success">Ho·∫°t ƒë·ªông</span></td>
                                        </tr>
                                        <tr>
                                            <td>T001</td>
                                            <td>Tour kh√°m ph√° n√∫i r·ª´ng</td>
                                            <td>C√°c tour trekking, leo n√∫i, kh√°m ph√° thi√™n nhi√™n hoang d√£</td>
                                            <td>10</td>
                                            <td>2024/11/05</td>
                                            <td><span class="badge bg-success">Ho·∫°t ƒë·ªông</span></td>
                                        </tr>
                                        <tr>
                                            <td>T001</td>
                                            <td>Tour du l·ªãch vƒÉn h√≥a</td>
                                            <td>C√°c tour tham quan di t√≠ch l·ªãch s·ª≠, vƒÉn h√≥a, l·ªÖ h·ªôi truy·ªÅn th·ªëng</td>
                                            <td>8</td>
                                            <td>2024/09/15</td>
                                            <td><span class="badge bg-danger">B·ªã ·∫©n</span></td>
                                        </tr>
                                        <tr>
                                            <td>T001</td>
                                            <td>Tour ·∫©m th·ª±c</td>
                                            <td>C√°c tour kh√°m ph√° ·∫©m th·ª±c ƒë·ªãa ph∆∞∆°ng, tr·∫£i nghi·ªám n·∫•u ƒÉn</td>
                                            <td>12</td>
                                            <td>2024/10/30</td>
                                            <td><span class="badge bg-success">Ho·∫°t ƒë·ªông</span></td>
                                        </tr>
                                        <tr>
                                            <td>T001</td>
                                            <td>Tour du l·ªãch gia ƒë√¨nh</td>
                                            <td>C√°c tour ph√π h·ª£p cho c·∫£ gia ƒë√¨nh, c√≥ ho·∫°t ƒë·ªông cho tr·∫ª em</td>
                                            <td>20</td>
                                            <td>2024/11/10</td>
                                            <td><span class="badge bg-success">Ho·∫°t ƒë·ªông</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer id="footer" class="footer">
        <div class="copyright">
            &copy; Copyright <strong><span>Nh√≥m 5</span></strong>. M·ªçi quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u
        </div>
        <div class="credits">
            Thi·∫øt k·∫ø b·ªüi <a href="https://bootstrapmade.com/">BootstrapMade</a>
        </div>
    </footer>
    <div class="modal fade" id="addTourModal" tabindex="-1" aria-labelledby="addTourModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold" id="addTourModalLabel">Th√™m danh m·ª•c tour m·ªõi</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted mb-4">T·∫°o danh m·ª•c chuy·∫øn ƒëi v·ªõi th√¥ng tin chi ti·∫øt </p>
                    <form id="addTourForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">T√™n Danh m·ª•c</label>
                                <input type="text" name="categoryName" class="form-control"
                                    placeholder="Nh·∫≠p t√™n danh m·ª•c" maxlength="254" required
                                    oninput="limitText(this, 254)">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Tr·∫°ng th√°i</label>
                                <select name="status" class="form-select" required>
                                    <option value="">-- Ch·ªçn tr·∫°ng th√°i --</option>
                                    <option value="active">Ho·∫°t ƒë·ªông</option>
                                    <option value="hidden"> ·∫®n</option>
                                </select>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label fw-bold mb-2">M√¥ t·∫£</label>
                                <div id="quillEditor" class="border rounded shadow-sm" style="height: 150px;"></div>
                                <textarea name="description" id="description" hidden></textarea>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label fw-bold mb-2">·∫¢nh danh m·ª•c</label>

                                <!-- Input ch·ªçn ·∫£nh -->
                                <div id="uploadContainer">
                                    <input type="file" id="tourImage" name="tourImage" class="form-control"
                                        accept="image/*" required>
                                </div>

                                <!-- ·∫¢nh xem tr∆∞·ªõc -->
                                <div class="mt-3 p-2 border rounded" id="imagePreviewContainer" style="display:none;">
                                    <img id="imagePreview" src="#" alt="·∫¢nh xem tr∆∞·ªõc" class="img-fluid rounded"
                                        style="max-height: 200px; object-fit: cover;">
                                    <div class="mt-2 text-end">
                                        <button type="button" id="changeImageBtn"
                                            class="btn btn-sm btn-outline-primary">Thay ·∫£nh</button>
                                    </div>
                                </div>
                            </div>

                        </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="deleteTourBtn" style="display:none;">X√≥a danh
                        m·ª•c</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">L∆∞u danh m·ª•c</button>
                </div>
                </form>
            </div>
        </div>
    </div>
    <div id="alert-container"></div>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- 1. C·∫§U H√åNH V√Ä DOM ELEMENTS ---
            const API_URL = 'http://localhost:8080/api/v1/categories';

            let dataTable = null; // Bi·∫øn gi·ªØ th·ªÉ hi·ªán c·ªßa DataTables
            const modalEl = document.getElementById('addTourModal');
            const modal = new bootstrap.Modal(modalEl);
            const form = document.getElementById('addTourForm');
            const modalTitle = document.getElementById('addTourModalLabel');
            const modalDescriptionEl = modalEl.querySelector('p.text-muted');
            const deleteBtn = document.getElementById('deleteTourBtn');
            const categoryTable = document.getElementById('categoryTable'); // Th·∫ª <table>
            const categoryTableBody = document.querySelector('.datatable tbody');
            const descriptionInput = document.getElementById('description');
            const addButton = document.querySelector('[data-bs-target="#addTourModal"]');

            // Ph·∫ßn t·ª≠ cho Preview ·∫£nh
            const uploadContainer = document.getElementById('uploadContainer'); // DOM cho v√πng input file
            const imageInput = document.getElementById('tourImage');
            const previewImg = document.getElementById('imagePreview');
            const previewContainer = document.getElementById('imagePreviewContainer');
            const changeImageBtn = document.getElementById('changeImageBtn'); // N√∫t "Thay ·∫£nh"
            const selectAll = document.getElementById('selectAll'); // Checkbox ch·ªçn t·∫•t c·∫£
            const bulkBar = document.getElementById('bulkActionBar'); // Action bar h√†ng lo·∫°t
            const deleteSelectedBtn = document.getElementById('deleteSelectedBtn'); // N√∫t x√≥a h√†ng lo·∫°t
            const countEl = document.getElementById('selectedCount'); // S·ªë l∆∞·ª£ng ƒë√£ ch·ªçn

            const quill = new Quill('#quillEditor', { theme: 'snow' });
            let currentId = null;
            let currentImageUrl = null;
            let selectedIds = new Set(); // Set ƒë·ªÉ l∆∞u ID c√°c h√†ng ƒë√£ ch·ªçn

            // --- 2. C√ÅC H√ÄM H·ªñ TR·ª¢ CHUNG ---
            // üß© Gi·ªõi h·∫°n s·ªë k√Ω t·ª± nh·∫≠p
            function limitText(input, maxLength) {
                if (input.value.length > maxLength) {
                    input.value = input.value.slice(0, maxLength);
                    showAlert(`‚ö†Ô∏è T√™n danh m·ª•c ch·ªâ ƒë∆∞·ª£c t·ªëi ƒëa ${maxLength} k√Ω t·ª±`, 'warning');
                }
            }

            // üîî Alert g√≥c ph·∫£i
            function showAlert(message, type = 'success') {
                const container = document.getElementById('alert-container');
                const icons = { success: 'bi-check-circle-fill', info: 'bi-info-circle-fill', warning: 'bi-exclamation-triangle-fill', danger: 'bi-x-circle-fill' };
                const alert = document.createElement('div');
                alert.className = `alert alert-${type} bg-${type} text-light alert-dismissible fade show mb-2`;
                alert.innerHTML = `<i class="bi ${icons[type]} me-2"></i>${message}
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert"></button>`;
                container.appendChild(alert);
                setTimeout(() => alert.remove(), 3000);
            }

            /**
             * üñº Thi·∫øt l·∫≠p ch·ª©c nƒÉng xem tr∆∞·ªõc ·∫£nh.
             */
            function setupImagePreview(file, initialUrl = null) {
                if (file) {
                    previewImg.src = URL.createObjectURL(file);
                    previewContainer.style.display = 'block';
                    uploadContainer.style.display = 'none';
                } else if (initialUrl) {
                    previewImg.src = initialUrl;
                    previewContainer.style.display = 'block';
                    uploadContainer.style.display = 'none';
                } else {
                    previewImg.src = '#';
                    previewContainer.style.display = 'none';
                    uploadContainer.style.display = 'block';
                }
            }

            // üîÅ Reset modal
            function resetModalToDefault() {
                currentId = null;
                currentImageUrl = null;
                modalTitle.textContent = 'Th√™m danh m·ª•c tour m·ªõi';
                modalDescriptionEl.style.display = 'block';
                deleteBtn.style.display = 'none';
                form.reset();
                quill.setText('');
                imageInput.value = ''; // Reset input file
                setupImagePreview(null); // Reset ·∫£nh preview
            }

            // --- LOGIC CHECKBOX V√Ä H√ÄNH ƒê·ªòNG H√ÄNG LO·∫†T (ƒê√£ s·ª≠a l·ªói DataTables) ---

            // C·∫≠p nh·∫≠t thanh h√†nh ƒë·ªông h√†ng lo·∫°t
            function toggleBulkBar() {
                // countEl.textContent = selectedIds.size; // ƒê√£ th√™m span#selectedCount v√†o HTML
                bulkBar.classList.toggle('d-none', selectedIds.size === 0);
            }

            function highlightRow(cb, checked) {
                const tr = cb.closest('tr');
                if (checked) tr.classList.add('table-active');
                else tr.classList.remove('table-active');
            }

            /**
             * üß© G·∫Øn s·ª± ki·ªán checkbox cho c√°c h√†ng M·ªöI (ch·∫°y sau m·ªói l·∫ßn DataTables v·∫Ω l·∫°i)
             */
            function attachCheckboxEvents() {
                // ƒê·∫£m b·∫£o checkbox "Ch·ªçn t·∫•t c·∫£" ƒë∆∞·ª£c reset v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu
                if (selectAll) selectAll.checked = false;

                const rowCheckboxes = document.querySelectorAll('#categoryTable .row-checkbox');

                // --- A. Ch·ªçn t·∫•t c·∫£ ---
                if (selectAll) {
                    selectAll.onchange = e => {
                        const checked = e.target.checked;
                        selectedIds.clear(); // X√≥a t·∫•t c·∫£ tr∆∞·ªõc khi th√™m m·ªõi
                        rowCheckboxes.forEach(cb => {
                            cb.checked = checked;
                            const id = cb.dataset.id;
                            if (checked) selectedIds.add(id);
                            highlightRow(cb, checked);
                        });
                        toggleBulkBar();
                    };
                }

                // --- B. Ch·ªçn t·ª´ng d√≤ng ---
                rowCheckboxes.forEach(cb => {
                    const id = cb.dataset.id;
                    cb.checked = selectedIds.has(id);
                    highlightRow(cb, selectedIds.has(id));
                    cb.onchange = e => {
                        const checked = e.target.checked;
                        if (checked) selectedIds.add(id);
                        else selectedIds.delete(id);

                        highlightRow(cb, checked);
                        toggleBulkBar();

                        // üß† N·∫øu b·ªè ch·ªçn 1 d√≤ng => b·ªè check "Ch·ªçn t·∫•t c·∫£"
                        if (!checked && selectAll) {
                            selectAll.checked = false;
                        }
                        // ‚úÖ N·∫øu t·∫•t c·∫£ checkbox ƒë·ªÅu ƒë∆∞·ª£c ch·ªçn => t·ª± check l·∫°i "Ch·ªçn t·∫•t c·∫£"
                        const allChecked = [...document.querySelectorAll('#categoryTable .row-checkbox')]
                            .every(cb => cb.checked);
                        selectAll.checked = allChecked;
                    };

                });
                toggleBulkBar();
            }

            // --- 3. C√ÅC H√ÄM API CRUD ---
            function loadCategories() {
                if ($.fn.DataTable.isDataTable('#categoryTable')) {
                    $('#categoryTable').DataTable().ajax.reload(attachCheckboxEvents, false);
                    return;
                }

                $(document).ready(function () {
                    dataTable = $('#categoryTable').DataTable({
                        serverSide: true,
                        processing: true,
                        searching: true,
                        lengthChange: true,
                        pageLength: 5,
                        lengthMenu: [[5, 10, 25, 50, -1], [5, 10, 25, 50, "T·∫•t c·∫£"]],
                        order: [[1, 'asc']],
                        columnDefs: [
                            { targets: 0, orderable: false, searchable: false }],
                        ajax: function (data, callback) {
                            const page = Math.floor(data.start / data.length);
                            const size = data.length;
                            const searchValue = data.search.value ? data.search.value : '';
                            const sortColIndex = data.order.length > 0 ? data.order[0].column : 1;
                            const columnMap = ['id', 'categoryId', 'categoryName', 'description', 'createdAt', 'status'];
                            const sortColName = columnMap[sortColIndex] || 'categoryId';
                            const sortDir = data.order.length > 0 ? data.order[0].dir : 'asc';

                            const url = `${API_URL}?page=${page}&size=${size}&sort=${sortColName},${sortDir}&keyword=${encodeURIComponent(searchValue)}`;

                            fetch(url)
                                .then(res => res.json())
                                .then(json => {
                                    // C·∫≠p nh·∫≠t t·ªïng s·ªë danh m·ª•c tr√™n th·∫ª card
                                    document.getElementById('totalCategories').textContent = json.totalElements;

                                    // G·ª≠i d·ªØ li·ªáu v·ªÅ cho DataTables
                                    callback({
                                        recordsTotal: json.totalElements,
                                        recordsFiltered: json.totalElements,
                                        data: json.content
                                    });
                                })
                                .catch(err => {
                                    console.error("L·ªói t·∫£i d·ªØ li·ªáu:", err);
                                    showAlert('L·ªói t·∫£i danh m·ª•c: ' + err.message, 'danger');
                                    callback({ data: [], recordsTotal: 0, recordsFiltered: 0 });
                                });
                        },
                        columns: [
                            { // C·ªôt Checkbox
                                data: null,
                                orderable: false,
                                searchable: false,
                                render: (data, type, row) => {
                                    // ƒê√£ s·ª≠a l·ªói: D√πng row.id (ho·∫∑c categoryId) ƒë·ªÉ g√°n cho data-id
                                    return `<input type="checkbox" class="row-checkbox" data-id="${row.id || row.categoryId}">`;
                                }
                            },
                            { data: 'id', title: 'M√£ danh m·ª•c' },
                            { // C·ªôt ·∫¢nh
                                data: 'imageUrl',
                                title: '·∫¢nh',
                                orderable: false,
                                render: url => url ? `<img src="${url}" width="60" height="40" style="object-fit:cover;border-radius:4px;">` : '-'
                            },
                            { data: 'categoryName', title: 'T√™n danh m·ª•c' },
                            {
                                data: 'description',
                                title: 'M√¥ t·∫£',
                                render: data => data ? new DOMParser().parseFromString(data, 'text/html').body.textContent.substring(0, 50) + '...' : '-'
                            },
                            { // C·ªôt Ng√†y t·∫°o (S·ª≠ d·ª•ng data: 'createdAt' n·∫øu API tr·∫£ v·ªÅ)
                                data: 'createdAt',
                                title: 'Ng√†y t·∫°o',
                                render: data => data ? data.split('T')[0] : ''
                            },
                            { // C·ªôt Tr·∫°ng th√°i
                                data: 'status',
                                title: 'Tr·∫°ng th√°i',
                                render: s => s ? '<span class="badge bg-success">Ho·∫°t ƒë·ªông</span>' : '<span class="badge bg-danger">·∫®n</span>'
                            }
                        ],
                        language: {
                            searchPlaceholder: "üîé T√¨m ki·∫øm...",
                            search: "",
                            lengthMenu: "_MENU_ / d√≤ng",
                            info: "Hi·ªÉn th·ªã _START_‚Äì_END_ trong t·ªïng _TOTAL_ danh m·ª•c",
                            infoEmpty: "Kh√¥ng c√≥ d·ªØ li·ªáu",
                            infoFiltered: "(l·ªçc t·ª´ _MAX_ b·∫£n ghi)",
                            zeroRecords: "Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p",
                            loadingRecords: "ƒêang t·∫£i d·ªØ li·ªáu...",
                            emptyTable: "Kh√¥ng c√≥ d·ªØ li·ªáu",
                            paginate: {
                                previous: "‚Üê Tr∆∞·ªõc",
                                next: "Ti·∫øp ‚Üí"
                            }
                        }
                    });

                    // G·∫Øn s·ª± ki·ªán sau khi DataTables v·∫Ω l·∫°i (Draw)
                    $('#categoryTable').on('draw.dt', function () {
                        attachCheckboxEvents();
                    });
                });
            }

            /** ‚úèÔ∏è Setup modal khi edit (Read Single) */
            async function setupModalForEdit(categoryId) {
                try {
                    const res = await fetch(`${API_URL}/${categoryId}`);
                    if (!res.ok) throw new Error('Category not found');
                    const cat = await res.json();

                    currentId = categoryId;
                    currentImageUrl = cat.imageUrl || null;
                    modalTitle.textContent = `Ch·ªânh s·ª≠a danh m·ª•c #${categoryId}`;
                    modalDescriptionEl.style.display = 'none';
                    deleteBtn.style.display = 'block';

                    imageInput.removeAttribute('required');

                    const categoryName = cat.categoryName || cat.name || '';
                    form.querySelector('[name="categoryName"]').value = categoryName;
                    quill.root.innerHTML = cat.description || '';
                    form.querySelector('[name="status"]').value = (cat.status == 1 || cat.status === true) ? 'active' : 'hidden';

                    setupImagePreview(null, currentImageUrl);

                    imageInput.value = null;
                    modal.show();
                } catch (err) {
                    showAlert('Kh√¥ng th·ªÉ t·∫£i chi ti·∫øt danh m·ª•c: ' + err.message, 'danger');
                }
            }

            /** Th√™m/C·∫≠p nh·∫≠t danh m·ª•c (Create/Update logic) */
            async function saveCategory(categoryData, id = null) {
                const method = id ? 'PUT' : 'POST';
                const url = id ? `${API_URL}/${id}` : API_URL;

                const res = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(categoryData)
                });
                if (!res.ok) throw new Error(`L·ªói khi ${id ? 'c·∫≠p nh·∫≠t' : 't·∫°o m·ªõi'} danh m·ª•c: ${res.statusText}`);
                return res.json();
            }

            /** X√≥a danh m·ª•c (Delete) */
            async function deleteCategory(id) {
                const res = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                if (!res.ok) throw new Error('L·ªói khi x√≥a danh m·ª•c: ' + res.statusText);
            }


            // --- 4. X·ª¨ L√ù S·ª∞ KI·ªÜN UI/CRUD ---

            // üñº L·∫Øng nghe s·ª± ki·ªán thay ƒë·ªïi file ƒë·ªÉ preview ·∫£nh
            imageInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                setupImagePreview(file);
            });

            // Khi ng∆∞·ªùi d√πng b·∫•m ‚ÄúThay ·∫£nh‚Äù
            if (changeImageBtn) {
                changeImageBtn.addEventListener('click', () => {
                    imageInput.click();
                });
            }

            // üíæ Submit form (Th√™m m·ªõi/C·∫≠p nh·∫≠t)
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                descriptionInput.value = quill.root.innerHTML;

                const imageFile = imageInput.files[0];
                let finalImageUrl = currentImageUrl; // Kh·ªüi t·∫°o b·∫±ng URL ·∫£nh c≈©

                try {
                    // üñº 1Ô∏è‚É£ Upload ·∫£nh: Ch·ªâ upload n·∫øu c√≥ file m·ªõi
                    if (imageFile) {
                        const uploadData = new FormData();
                        uploadData.append('file', imageFile);

                        showAlert('ƒêang upload ·∫£nh...', 'info');

                        const uploadRes = await fetch('http://localhost:8080/api/v1/categories/upload', {
                            method: 'POST',
                            body: uploadData
                        });

                        if (!uploadRes.ok) throw new Error('Upload ·∫£nh th·∫•t b·∫°i!');
                        const uploadResult = await uploadRes.json();
                        finalImageUrl = uploadResult.url; // Ghi ƒë√® b·∫±ng URL m·ªõi
                    }

                    // üóÇ 2Ô∏è‚É£ G·ª≠i d·ªØ li·ªáu danh m·ª•c
                    const formData = new FormData(form);
                    const category = {
                        categoryName: formData.get('categoryName'),
                        description: formData.get('description'),
                        status: formData.get('status') === 'active' ? 1 : 0,
                        imageUrl: finalImageUrl
                    };

                    await saveCategory(category, currentId);

                    modal.hide();
                    showAlert(
                        currentId ? 'C·∫≠p nh·∫≠t danh m·ª•c th√†nh c√¥ng!' : 'Th√™m danh m·ª•c m·ªõi th√†nh c√¥ng!',
                        'success'
                    );

                    // üî• RELOAD TRANG THEO Y√äU C·∫¶U:
                    setTimeout(() => window.location.reload(), 800);

                } catch (err) {
                    console.error(err);
                    showAlert('‚ùå ' + err.message, 'danger');
                }
            });


            // üóë X√≥a danh m·ª•c
            deleteBtn.addEventListener('click', async () => {
                if (!currentId) return;
                if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a danh m·ª•c #${currentId}?`)) {
                    try {
                        await deleteCategory(currentId);
                        modal.hide();
                        showAlert('X√≥a danh m·ª•c th√†nh c√¥ng!', 'danger');

                        // üî• RELOAD TRANG THEO Y√äU C·∫¶U:
                        setTimeout(() => window.location.reload(), 800);

                    } catch (err) {
                        showAlert('L·ªói khi x√≥a: ' + err.message, 'danger');
                    }
                }
            });

            // üóëÔ∏è X√≥a h√†ng lo·∫°t
            if (deleteSelectedBtn) {
                deleteSelectedBtn.addEventListener('click', async () => {
                    if (selectedIds.size === 0) return;
                    if (!confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ${selectedIds.size} danh m·ª•c ƒë√£ ch·ªçn?`)) return;

                    try {
                        const res = await fetch(`${API_URL}/bulk-delete`, {
                            method: 'DELETE',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify([...selectedIds])
                        });
                        if (!res.ok) throw new Error('Kh√¥ng th·ªÉ x√≥a danh m·ª•c');
                        showAlert(`ƒê√£ x√≥a ${selectedIds.size} danh m·ª•c`, 'success');

                        // üî• RELOAD TRANG THEO Y√äU C·∫¶U:
                        setTimeout(() => window.location.reload(), 800);

                    } catch (err) {
                        showAlert(err.message, 'danger');
                    }
                });
            }


            // ‚ö° G·∫Øn s·ª± ki·ªán UI kh√°c
            addButton.addEventListener('click', resetModalToDefault);

            // S·ª± ki·ªán click v√†o h√†ng c·ªßa DataTables (ph·∫£i g·∫Øn tr√™n body ƒë·ªÉ ho·∫°t ƒë·ªông sau khi draw)
            $('#categoryTable tbody').on('click', 'tr', function (e) {
                // B·ªè qua n·∫øu click v√†o checkbox
                if ($(e.target).is('input[type="checkbox"]')) return;

                // L·∫•y data c·ªßa d√≤ng n√†y
                const data = $('#categoryTable').DataTable().row(this).data();

                // Ki·ªÉm tra d·ªØ li·ªáu h·ª£p l·ªá
                if (!data) return;

                const categoryId = data.categoryId || data.id;

                if (categoryId) {
                    console.log('üü¢ Click v√†o d√≤ng:', categoryId, data); // debug
                    setupModalForEdit(categoryId);
                }
            });

            modalEl.addEventListener('hidden.bs.modal', resetModalToDefault);

            // üöÄ T·∫£i d·ªØ li·ªáu ban ƒë·∫ßu
            loadCategories();
        });

    </script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js" defer></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js" defer></script>
    <!-- <script src="assets/vendor/simple-datatables/simple-datatables.js" defer></script> -->
    <script src="assets/js/main.js" defer></script>
    <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

</body>

</html>